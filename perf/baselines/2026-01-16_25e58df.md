# 2026-01-16 — `25e58df`

Recorded at: 2026-01-16T19:54:24Z

## Environment

- Host: Darwin 24.6.0 (arm64)
- Postgres: 18.1 (Homebrew)
- Mix env: `MIX_ENV=bench`

## Dataset

Seed command:

```sh
MIX_ENV=bench mix egregoros.bench.seed --force --seed 123
```

Seed summary:

- users: local=12 remote=200
- notes: 73,000
- follows: 520

## Bench results

Command:

```sh
MIX_ENV=bench mix egregoros.bench.run --warmup 1 --iterations 5 --filter "timeline.home.edge_"
```

Output:

```text
timeline.home.edge_nofollows.list_home_statuses(limit=20)
  duration: avg 22.97ms p50 22.14ms p95 28.54ms (min 20.02ms max 28.54ms)
  queries:   avg 1.0 p95 1 | db_time: avg 22.75ms p95 28.33ms

timeline.home.edge_dormant.list_home_statuses(limit=20)
  duration: avg 22.9ms p50 22.73ms p95 24.38ms (min 21.98ms max 24.38ms)
  queries:   avg 1.0 p95 1 | db_time: avg 22.61ms p95 24.0ms
```

Command:

```sh
MIX_ENV=bench mix egregoros.bench.run --warmup 1 --iterations 5 \
  --filter "timeline.tag.list_public_statuses_by_hashtag(tag='bench', limit=20, only_media=true)"
```

Output:

```text
timeline.tag.list_public_statuses_by_hashtag(tag='bench', limit=20, only_media=true)
  duration: avg 9.43ms p50 8.22ms p95 13.75ms (min 7.34ms max 13.75ms)
  queries:   avg 1.0 p95 1 | db_time: avg 9.36ms p95 13.69ms
```

Command:

```sh
MIX_ENV=bench mix egregoros.bench.run --warmup 1 --iterations 5 \
  --filter "thread.count_note_replies_by_parent_ap_ids"
```

Output:

```text
thread.count_note_replies_by_parent_ap_ids(parent_count=20)
  duration: avg 3.17ms p50 2.88ms p95 4.3ms (min 2.67ms max 4.3ms)
  queries:   avg 1.0 p95 1 | db_time: avg 3.14ms p95 4.28ms
```

## EXPLAIN highlights

Generated with:

```sh
MIX_ENV=bench mix egregoros.bench.explain --no-print --filter "timeline.home.edge_"
MIX_ENV=bench mix egregoros.bench.explain --no-print \
  --filter "timeline.tag.list_public_statuses_by_hashtag(tag='bench', limit=20, only_media=true)"
MIX_ENV=bench mix egregoros.bench.explain --no-print --filter "thread.count_note_replies_by_parent_ap_ids"
```

Highlights:

- Tag timeline `only_media=true` uses `objects_note_has_media_id_index` (Bitmap Index Scan) and stays at 1 query for the page.
- Replies count uses `objects_in_reply_to_ap_id_id_index` (Index Only Scan + GroupAggregate).
- Home sparse timelines (`edge_nofollows` / `edge_dormant`) still show a parallel seq scan / hash join plan on the main actor branch even when returning 0 results (likely influenced by dataset size and planner estimates). Treat the ~30ms p95 here as “watch, but not panic”.
