/* See the Tailwind configuration guide for advanced usage
   https://tailwindcss.com/docs/configuration */

@import "tailwindcss" source(none);
@source "../css";
@source "../js";
@source "../../lib/egregoros_web";

@import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap");

/* A Tailwind plugin that makes "hero-#{ICON}" classes available.
   The heroicons installation itself is managed by your mix.exs */
@plugin "../vendor/heroicons";

/* Add variants based on LiveView classes */
@custom-variant phx-click-loading (.phx-click-loading&, .phx-click-loading &);
@custom-variant phx-submit-loading (.phx-submit-loading&, .phx-submit-loading &);
@custom-variant phx-change-loading (.phx-change-loading&, .phx-change-loading &);

/* Use the data attribute for dark mode  */
@custom-variant dark (&:where([data-theme=dark], [data-theme=dark] *));

/* Make LiveView wrapper divs transparent for layout */
[data-phx-session], [data-phx-teleported-src] { display: contents }

/* ═══════════════════════════════════════════════════════════
   BRUTALIST MINIMAL DESIGN SYSTEM
   A stark, utilitarian theme with high contrast
   ═══════════════════════════════════════════════════════════ */

:root {
  --font-sans: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  --font-mono: "JetBrains Mono", ui-monospace, monospace;

  /* Light mode - pure black and white */
  --bg-base: #ffffff;
  --bg-subtle: #f5f5f5;
  --bg-muted: #ebebeb;
  --bg-emphasis: #000000;

  --text-primary: #000000;
  --text-secondary: #555555;
  --text-muted: #888888;

  --border-default: #000000;
  --border-muted: #888888;

  /* Accent - pure black */
  --accent-primary: #000000;
  --accent-primary-hover: #333333;
  --accent-primary-subtle: #f5f5f5;

  /* Secondary accent - same as primary for brutalist */
  --accent-secondary: #000000;
  --accent-secondary-hover: #333333;
  --accent-secondary-subtle: #f5f5f5;

  /* Semantic colors - stark */
  --success: #008800;
  --success-subtle: #e8f5e8;
  --danger: #cc0000;
  --danger-subtle: #ffe8e8;
  --warning: #cc8800;
  --warning-subtle: #fff5e8;

  /* Link color */
  --link: #0000ee;
}

[data-theme="dark"] {
  /* Dark mode - inverted */
  --bg-base: #0a0a0a;
  --bg-subtle: #141414;
  --bg-muted: #1f1f1f;
  --bg-emphasis: #ffffff;

  --text-primary: #ffffff;
  --text-secondary: #aaaaaa;
  --text-muted: #666666;

  --border-default: #ffffff;
  --border-muted: #666666;

  /* Accent - pure white in dark mode */
  --accent-primary: #ffffff;
  --accent-primary-hover: #cccccc;
  --accent-primary-subtle: #1f1f1f;

  --accent-secondary: #ffffff;
  --accent-secondary-hover: #cccccc;
  --accent-secondary-subtle: #1f1f1f;

  --success: #44cc44;
  --success-subtle: #0a200a;
  --danger: #ff4444;
  --danger-subtle: #200a0a;
  --warning: #ffaa44;
  --warning-subtle: #201a0a;

  /* Link color */
  --link: #88aaff;
}

body {
  font-family: var(--font-sans);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.font-mono {
  font-family: var(--font-mono);
}

/* ═══════════════════════════════════════════════════════════
   ANIMATIONS (minimal for brutalist)
   ═══════════════════════════════════════════════════════════ */

@keyframes rise-fade {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

.animate-rise {
  animation: rise-fade 0.2s ease-out both;
}

@media (prefers-reduced-motion: reduce) {
  .animate-rise {
    animation: none;
  }
}

/* ═══════════════════════════════════════════════════════════
   CUSTOM COMPONENT STYLES (Brutalist)
   ═══════════════════════════════════════════════════════════ */

/* Custom emoji should behave like inline glyphs (Tailwind preflight sets img to display:block) */
img.emoji {
  display: inline-block;
  vertical-align: -0.125em;
}

/* Mention links - simple underline on hover */
a.mention-link {
  color: var(--link);
  font-weight: 500;
  text-decoration: none;
}

a.mention-link:hover {
  text-decoration: underline;
  text-underline-offset: 2px;
}

/* Mention autocomplete suggestions */
[data-role="mention-suggestion"][data-selected="true"] {
  background-color: var(--bg-subtle);
}

/* Anchor navigation inside threads */
article[data-role="status-card"] {
  scroll-margin-top: 6rem;
}

article[data-role="status-card"]:target {
  outline: 2px solid var(--border-default);
  outline-offset: 4px;
}

/* Brutalist focus shadow */
.focus-brutal:focus,
.focus-brutal:focus-visible {
  outline: none;
  box-shadow: 4px 4px 0 var(--border-default);
}

/* Brutalist button hover effect */
.btn-brutal {
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

.btn-brutal:hover {
  transform: translate(-2px, -2px);
  box-shadow: 4px 4px 0 var(--border-default);
}

.btn-brutal:active {
  transform: translate(0, 0);
  box-shadow: none;
}

/* Inverted button style */
.btn-inverted {
  background: var(--text-primary);
  color: var(--bg-base);
  border: 2px solid var(--border-default);
}

.btn-inverted:hover {
  background: var(--accent-primary-hover);
}

/* ═══════════════════════════════════════════════════════════
   NOTIFICATIONS FILTERING (client-side)
   ═══════════════════════════════════════════════════════════ */

[data-role="notifications-list"][data-filter="follows"] [data-role="notification"]:not([data-type="Follow"]) {
  display: none;
}

[data-role="notifications-list"]:not([data-filter="requests"]) [data-role="follow-requests"] {
  display: none;
}

[data-role="notifications-list"][data-filter="requests"] [data-role="notifications-stream"] {
  display: none;
}

[data-role="notifications-list"][data-filter="likes"] [data-role="notification"]:not([data-type="Like"]) {
  display: none;
}

[data-role="notifications-list"][data-filter="reposts"] [data-role="notification"]:not([data-type="Announce"]) {
  display: none;
}

[data-role="notifications-list"][data-filter="mentions"] [data-role="notification"]:not([data-type="Note"]) {
  display: none;
}

[data-role="notifications-list"][data-filter="reactions"]
  [data-role="notification"]:not([data-type="EmojiReact"]) {
  display: none;
}

/* ═══════════════════════════════════════════════════════════
   NOTIFICATIONS VISUAL HIERARCHY
   High: Mentions/Replies - elevated cards with shadow
   Medium: Follows/Reposts - standard cards
   Low: Likes/Reactions - minimal inline styling
   ═══════════════════════════════════════════════════════════ */

/* HIGH IMPORTANCE: Mentions (Note type) */
[data-role="notification"][data-importance="high"] {
  border-width: 2px;
  border-color: var(--border-default);
  box-shadow: 4px 4px 0 var(--border-default);
  position: relative;
}

[data-role="notification"][data-importance="high"]:hover {
  transform: translate(-2px, -2px);
  box-shadow: 6px 6px 0 var(--border-default);
}

[data-role="notification"][data-importance="high"]::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: var(--text-primary);
}

/* MEDIUM IMPORTANCE: Follows, Reposts */
[data-role="notification"][data-importance="medium"] {
  border-width: 1px;
  border-color: var(--border-muted);
  box-shadow: none;
  position: relative;
}

[data-role="notification"][data-importance="medium"]::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--text-muted);
}

/* LOW IMPORTANCE: Likes, Reactions - compact inline style */
[data-role="notification"][data-importance="low"] {
  border: none;
  border-bottom: 1px dashed var(--border-muted);
  background: var(--bg-subtle);
  padding: 10px 16px;
  position: relative;
  /* Remove the space-y-4 gap from parent */
  margin-top: -1rem;
}

/* First low importance item after non-low needs normal margin */
[data-role="notification"]:not([data-importance="low"]) + [data-role="notification"][data-importance="low"] {
  margin-top: 0;
}

/* Consecutive low importance items stack together */
[data-role="notification"][data-importance="low"] + [data-role="notification"][data-importance="low"] {
  margin-top: -1rem;
}

[data-role="notification"][data-importance="low"]:last-child {
  border-bottom: none;
}

[data-role="notification"][data-importance="low"]::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 2px;
  height: 16px;
  background: var(--border-muted);
}

/* High importance badge */
[data-role="notification-badge"] {
  position: absolute;
  top: -8px;
  right: 16px;
  background: var(--text-primary);
  color: var(--bg-base);
  font-size: 9px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 4px 8px;
}

/* ═══════════════════════════════════════════════════════════
   SCROLLBAR STYLING (Brutalist - no rounded corners)
   ═══════════════════════════════════════════════════════════ */

::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--bg-subtle);
  border-left: 1px solid var(--border-muted);
}

::-webkit-scrollbar-thumb {
  background: var(--text-muted);
  border: 1px solid var(--border-muted);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-primary);
}

/* Firefox */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--text-muted) var(--bg-subtle);
}

/* ═══════════════════════════════════════════════════════════
   SELECTION STYLING
   ═══════════════════════════════════════════════════════════ */

::selection {
  background: var(--text-primary);
  color: var(--bg-base);
}

/* ═══════════════════════════════════════════════════════════
   BRUTALIST AUDIO PLAYER
   ═══════════════════════════════════════════════════════════ */

.audio-player {
  display: flex;
  flex-direction: column;
  gap: 0;
  width: 100%;
  background: var(--bg-subtle);
  border: 2px solid var(--border-default);
}

.audio-player-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-bottom: 2px solid var(--border-default);
  min-height: 72px;
}

.audio-player-artwork {
  flex-shrink: 0;
  width: 48px;
  height: 48px;
  background: var(--bg-muted);
  border: 1px solid var(--border-muted);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted);
  overflow: hidden;
}

.audio-player-artwork-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.audio-player-metadata {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.audio-player-title {
  font-weight: 600;
  font-size: 14px;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.audio-player-artist {
  font-size: 12px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: none;
}

.audio-player-visualizer {
  flex-shrink: 0;
  width: 120px;
  height: 48px;
  display: block;
  background: var(--bg-subtle);
}

.audio-player-controls {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
}

.audio-player-play {
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  background: var(--bg-emphasis);
  color: var(--bg-base);
  border: 2px solid var(--border-default);
  cursor: pointer;
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

.audio-player-play:hover {
  transform: translate(-2px, -2px);
  box-shadow: 4px 4px 0 var(--border-default);
}

.audio-player-play:active {
  transform: translate(0, 0);
  box-shadow: none;
}

.audio-player-play:focus-visible {
  outline: none;
  box-shadow: 4px 4px 0 var(--border-default);
}

.audio-player-play svg {
  width: 20px;
  height: 20px;
}

.audio-player-progress-container {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 10px;
}

.audio-player-time {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-secondary);
  min-width: 40px;
  text-align: center;
}

.audio-player-progress {
  flex: 1;
  height: 8px;
  background: var(--bg-muted);
  border: 1px solid var(--border-muted);
  cursor: pointer;
  position: relative;
}

.audio-player-progress:focus-visible {
  outline: none;
  box-shadow: 2px 2px 0 var(--border-default);
}

.audio-player-progress-fill {
  height: 100%;
  background: var(--text-primary);
  width: 0%;
  transition: width 0.1s linear;
}

/* ═══════════════════════════════════════════════════════════
   BRUTALIST VIDEO PLAYER
   ═══════════════════════════════════════════════════════════ */

.video-player {
  position: relative;
  width: 100%;
  background: #000;
  border: 2px solid var(--border-default);
}

.video-player:focus {
  outline: none;
}

.video-player:focus-visible {
  box-shadow: 4px 4px 0 var(--border-default);
}

.video-player-container {
  position: relative;
  width: 100%;
}

.video-player-video {
  display: block;
  width: 100%;
  height: auto;
  max-height: 70vh;
  object-fit: contain;
  background: #000;
}

.video-player-click-overlay {
  position: absolute;
  inset: 0;
  cursor: pointer;
}

.video-player-controls {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
  transition: opacity 0.2s ease;
}

.video-player-controls-hidden {
  opacity: 0;
  pointer-events: none;
}

.video-player-btn {
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  background: var(--bg-emphasis);
  color: var(--bg-base);
  border: 2px solid var(--border-default);
  cursor: pointer;
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

.video-player-btn:hover {
  transform: translate(-1px, -1px);
  box-shadow: 2px 2px 0 var(--border-default);
}

.video-player-btn:active {
  transform: translate(0, 0);
  box-shadow: none;
}

.video-player-btn:focus-visible {
  outline: none;
  box-shadow: 2px 2px 0 var(--border-default);
}

.video-player-speed-btn {
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 600;
  width: auto;
  padding: 0 8px;
  min-width: 44px;
}

.video-player-progress-container {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 8px;
}

.video-player-time {
  font-family: var(--font-mono);
  font-size: 11px;
  color: #fff;
  min-width: 36px;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
}

.video-player-progress {
  flex: 1;
  height: 6px;
  background: rgba(255, 255, 255, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.5);
  cursor: pointer;
  position: relative;
}

.video-player-progress:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px #fff;
}

.video-player-progress-fill {
  height: 100%;
  background: #fff;
  width: 0%;
  transition: width 0.1s linear;
}

/* Fullscreen styles */
.video-player:fullscreen {
  display: flex;
  align-items: center;
  justify-content: center;
}

.video-player:fullscreen .video-player-container {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.video-player:fullscreen .video-player-video {
  max-height: 100vh;
  max-width: 100vw;
}

.video-player:fullscreen .video-player-controls {
  padding: 12px 24px;
}

.video-player:fullscreen .video-player-btn {
  width: 44px;
  height: 44px;
}

.video-player:fullscreen .video-player-time {
  font-size: 13px;
}

.video-player:fullscreen .video-player-progress {
  height: 8px;
}

/* ═══════════════════════════════════════════════════════════
   CRT EFFECT FOR VIDEO PLAYER
   ═══════════════════════════════════════════════════════════ */

.video-player {
  overflow: hidden;
  border-radius: 16px;
}

.video-player-container {
  border-radius: 14px;
  overflow: hidden;
}

/* Curvature effect via pseudo-element */
.video-player-container::before {
  content: "";
  position: absolute;
  inset: 0;
  z-index: 5;
  pointer-events: none;
  /* Strong vignette for curved CRT look */
  box-shadow:
    inset 0 0 120px 40px rgba(0, 0, 0, 0.5),
    inset 0 0 60px 20px rgba(0, 0, 0, 0.4),
    inset 0 0 20px 5px rgba(0, 0, 0, 0.3);
  border-radius: 14px;
}

/* Scanlines overlay */
.video-player-container::after {
  content: "";
  position: absolute;
  inset: 0;
  z-index: 4;
  pointer-events: none;
  background: repeating-linear-gradient(
    0deg,
    rgba(0, 0, 0, 0.15) 0px,
    rgba(0, 0, 0, 0.15) 1px,
    transparent 1px,
    transparent 2px
  );
  border-radius: 6px;
}

/* Chromatic aberration on the video itself */
.video-player-video {
  animation: crt-flicker 0.15s infinite;
  filter: contrast(1.1) brightness(1.05);
}

/* Chromatic aberration container */
.video-player-container {
  position: relative;
}

/* RGB shift effect using shadows on a wrapper */
.video-player-video {
  text-shadow: none;
  position: relative;
}

/* Create chromatic aberration with CSS filter trick */
@supports (filter: url(#crt-aberration)) {
  .video-player-video {
    filter: url(#crt-aberration) contrast(1.1) brightness(1.05);
  }
}

/* Subtle CRT flicker animation */
@keyframes crt-flicker {
  0% { opacity: 1; }
  5% { opacity: 0.98; }
  10% { opacity: 1; }
  15% { opacity: 0.99; }
  20% { opacity: 1; }
  50% { opacity: 1; }
  55% { opacity: 0.985; }
  60% { opacity: 1; }
  100% { opacity: 1; }
}

/* Screen glow effect */
.video-player::before {
  content: "";
  position: absolute;
  inset: -2px;
  z-index: -1;
  background: rgba(100, 200, 255, 0.03);
  filter: blur(8px);
  border-radius: 12px;
  animation: crt-glow 4s ease-in-out infinite;
}

@keyframes crt-glow {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 0.8; }
}

/* Disable animations for reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .video-player-video {
    animation: none;
  }
  .video-player::before {
    animation: none;
  }
}

/* Clean mode - disable all CRT effects */
.video-player-clean {
  border-radius: 2px;
}

.video-player-clean .video-player-container {
  border-radius: 0;
}

.video-player-clean .video-player-container::before,
.video-player-clean .video-player-container::after {
  display: none;
}

.video-player-clean .video-player-video {
  animation: none;
  filter: none;
}

.video-player-clean::before {
  display: none;
}

/* ═══════════════════════════════════════════════════════════
   DARK MODE IMAGE OVERLAY
   Reduces brightness and adds scanlines to prevent flashbanging
   Only active in dark theme
   ═══════════════════════════════════════════════════════════ */

/* Brightness/contrast filter applied directly to images - dark mode only */
[data-theme="dark"] .image-dark-filter {
  filter: brightness(0.82) contrast(1.05);
}

/* Scanlines overlay element - hidden by default, shown in dark mode */
.image-scanlines-overlay {
  display: none;
}

[data-theme="dark"] .image-scanlines-overlay {
  display: block;
  background:
    repeating-linear-gradient(
      0deg,
      rgba(0, 0, 0, 0.12) 0px,
      rgba(0, 0, 0, 0.12) 1px,
      transparent 1px,
      transparent 2px
    );
  box-shadow:
    inset 0 0 80px 30px rgba(0, 0, 0, 0.25),
    inset 0 0 30px 10px rgba(0, 0, 0, 0.15);
}
